{% extends "base.html" %}
{% load seo_tags %}
{% block title %}حریم خصوصی - {{ site_settings.site_name }}{% endblock %}
{% block meta_description %}سیاست حریم خصوصی {{ site_settings.site_name|default:'Accountinox' }} و نحوه مدیریت اطلاعات کاربران.{% endblock %}
{% block content %}
<div class="page-wrapper max-w-3xl">
  <nav class="mb-8 reveal" aria-label="breadcrumb">
    <div class="flex items-center gap-2 text-sm text-gray-400">
      <a href="{% url 'core:landing' %}" class="hover:text-primary-600 transition-colors">خانه</a>
      <svg class="w-3 h-3 rotate-180 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
      <span class="text-gray-600 font-medium">حریم خصوصی</span>
    </div>
  </nav>

  <div class="text-center mb-8 reveal">
    <span class="chip">سند حقوقی</span>
    <h1 class="section-title mt-4">حریم خصوصی</h1>
    <p class="section-subtitle mt-2 mx-auto">
      در این صفحه توضیح داده‌ایم چه اطلاعاتی جمع‌آوری می‌شود، چگونه نگهداری می‌شود و چه حقوقی روی داده‌های خود دارید.
    </p>
    <p class="mt-4 text-xs text-gray-500">
      آخرین به‌روزرسانی:
      {% if site_settings and site_settings.privacy_updated %}
      <span class="font-medium text-gray-700">{{ site_settings.privacy_updated|jdate:"Y/m/d H:i" }}</span>
      {% else %}
      <span class="font-medium text-gray-700">ثبت نشده</span>
      {% endif %}
    </p>
  </div>

  <div class="card p-5 sm:p-6 reveal">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <div>
        <h2 class="text-sm font-bold text-gray-900">راهنمای سریع این صفحه</h2>
        <p class="text-sm text-gray-500 mt-1">برای پیمایش بهتر، فهرست سرفصل‌ها از متن زیر ساخته می‌شود.</p>
      </div>
      <div class="flex flex-wrap gap-2">
        <a href="{% url 'support:chat' %}" class="btn btn-primary btn-sm">چت پشتیبانی</a>
        <a href="{% url 'core:contact' %}" class="btn btn-secondary btn-sm">تماس با ما</a>
      </div>
    </div>

    <div class="divider my-5"></div>

    <div class="flex flex-col gap-3">
      <p class="text-xs text-gray-500">فهرست سرفصل‌ها</p>
      <ul id="legal-toc" class="space-y-2 text-sm text-gray-600"></ul>
      <p id="legal-toc-empty" class="text-sm text-gray-500">پس از بارگذاری متن، سرفصل‌های این سند اینجا نمایش داده می‌شوند.</p>
    </div>
  </div>

  <div class="card p-6 sm:p-8 mt-6 reveal">
    {% if site_settings and site_settings.privacy_html %}
    <div id="legal-content" class="prose">{{ site_settings.privacy_html|safe }}</div>
    {% else %}
    <div class="alert alert-info">
      <svg class="w-5 h-5 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
      <p class="leading-7">متن سیاست حریم خصوصی هنوز توسط ادمین سایت وارد نشده است. لطفاً به پنل ادمین مراجعه کنید.</p>
    </div>
    {% endif %}
  </div>

  <div class="mt-6 text-center reveal">
    <a href="{% url 'core:terms' %}" class="inline-flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-medium text-gray-500 hover:text-primary-600 hover:bg-primary-50/50 transition-all">
      مشاهده شرایط استفاده
      <svg class="w-4 h-4 rtl:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
    </a>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
{{ block.super }}
<script>
  (function () {
    const content = document.getElementById('legal-content');
    const toc = document.getElementById('legal-toc');
    const tocEmpty = document.getElementById('legal-toc-empty');

    if (!content || !toc || !tocEmpty) return;

    const headings = content.querySelectorAll('h2, h3');
    if (!headings.length) {
      toc.innerHTML = '<li class="text-gray-500">این سند سرفصل قابل نمایش ندارد.</li>';
      tocEmpty.classList.add('hidden');
      return;
    }

    const fragment = document.createDocumentFragment();
    headings.forEach((heading, index) => {
      if (!heading.id) {
        heading.id = 'privacy-section-' + (index + 1);
      }

      const item = document.createElement('li');
      if (heading.tagName === 'H3') {
        item.className = 'pr-4 text-gray-500';
      }

      const link = document.createElement('a');
      link.href = '#' + heading.id;
      link.className = 'hover:text-primary-600 transition-colors';
      link.textContent = heading.textContent.trim();

      item.appendChild(link);
      fragment.appendChild(item);
    });

    toc.appendChild(fragment);
    tocEmpty.classList.add('hidden');
  })();
</script>
{% endblock %}
