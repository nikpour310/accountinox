{% extends 'base.html' %}

{% block meta_title %}پشتیبانی | {{ site_settings.site_name|default:'Accountinox' }}{% endblock %}
{% block meta_description %}شروع گفت‌وگو با پشتیبانی {{ site_settings.site_name|default:'Accountinox' }} برای سوالات خرید و پیگیری سفارش.{% endblock %}
{% block meta_robots %}
<meta name="robots" content="noindex,nofollow">
{% endblock %}
{% block canonical %}<link rel="canonical" href="{{ site_base_url }}{% url 'support:chat' %}">{% endblock %}

{% block content %}
<div class="page-wrapper max-w-2xl">
  <div class="text-center mb-8 reveal">
    <h1 class="section-title">پشتیبانی آنلاین</h1>
    <p class="section-subtitle mt-2">برای شروع گفت‌وگو، اطلاعات تماس را وارد کنید تا سریع‌تر راهنمایی شوید.</p>
  </div>

  {% if active_session %}
    <div class="alert alert-success mb-5 reveal">
      گفت‌وگوی فعال دارید.
      <a class="font-semibold underline" href="{% url 'support:chat_room' %}">ادامه گفت‌وگو</a>
    </div>
  {% endif %}

  {% if closed_unrated_session %}
    <div class="alert alert-info mb-5 reveal">
      گفت‌وگوی قبلی شما بسته شده است.
      <a class="font-semibold underline" href="{% url 'support:rate_session' closed_unrated_session.id %}">ثبت امتیاز پشتیبانی</a>
    </div>
  {% endif %}

  <div class="card p-6 sm:p-8 reveal">
    <h2 class="text-base font-semibold text-gray-900 mb-1">شروع گفت‌وگو</h2>
    <p class="text-sm text-gray-500 mb-5">اطلاعات زیر را وارد کنید.</p>
    <form method="post" action="{% url 'support:start_chat' %}" class="space-y-4">
      {% csrf_token %}
      <div>
        <label for="support-name" class="form-label">نام</label>
        <input
          id="support-name"
          name="name"
          type="text"
          class="form-input"
          value="{{ form_name|default:'' }}"
          placeholder="نام و نام خانوادگی"
          required
        >
        {% if form_errors.name %}
          <p class="mt-1 text-xs text-red-600">{{ form_errors.name }}</p>
        {% endif %}
      </div>

      <div>
        <label for="support-phone" class="form-label">شماره موبایل</label>
        <input
          id="support-phone"
          name="phone"
          type="tel"
          class="form-input"
          value="{{ form_phone|default:'' }}"
          placeholder="09123456789"
          inputmode="numeric"
          required
        >
        <p class="mt-1.5 text-xs text-gray-400">فرمت قابل قبول: 09xxxxxxxxx یا +989xxxxxxxxx</p>
        {% if form_errors.phone %}
          <p class="mt-1 text-xs text-red-600">{{ form_errors.phone }}</p>
        {% endif %}
      </div>

      <button type="submit" class="btn btn-primary w-full sm:w-auto">ورود به چت</button>
    </form>
  </div>

  {% if site_settings.telegram_admin_url or site_settings.telegram_channel_url %}
    <div class="card p-6 mt-6 reveal">
      <h2 class="text-base font-semibold text-gray-900 mb-1">{{ site_settings.telegram_support_label|default:'پشتیبانی تلگرام' }}</h2>
      <p class="text-sm text-gray-500 mb-4">از طریق تلگرام هم می‌توانید با ما در ارتباط باشید.</p>
      <div class="flex flex-col gap-2 sm:flex-row">
        {% if site_settings.telegram_admin_url %}
          <a href="{{ site_settings.telegram_admin_url }}" target="_blank" rel="noopener noreferrer" class="btn btn-secondary w-full sm:w-auto">
            ارتباط با ادمین
          </a>
        {% endif %}
        {% if site_settings.telegram_channel_url %}
          <a href="{{ site_settings.telegram_channel_url }}" target="_blank" rel="noopener noreferrer" class="btn btn-ghost w-full sm:w-auto">
            کانال اطلاع‌رسانی
          </a>
        {% endif %}
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}
